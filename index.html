<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sorteos El Colotero</title>

<style>
body{font-family:Arial;background:#f4f4f4;padding:20px}
.grid{display:grid;grid-template-columns:repeat(10,1fr);gap:6px}
.num{padding:8px;border:1px solid #ccc;text-align:center;cursor:pointer;transition:.2s}
.num:hover{transform:scale(1.05)}
.num.selected{background:#4caf50;color:#fff}
.num.blocked{background:#999;color:#fff;cursor:not-allowed}
form,.extra{background:#fff;padding:15px;margin-top:15px}
input,select,button{width:100%;padding:8px;margin-top:6px}
</style>
</head>

<body>

<h2>Sorteos El Colotero</h2>

<h3 style="color:#d32f2f">
üéâ GRAN PREMIO: $1,500.00 MXN üéâ
</h3>

<p id="contador">Boletos seleccionados: 0</p>

<div class="grid" id="grid"></div>

<form id="form">
<input id="nombre" placeholder="Nombre" required>
<input id="apellido" placeholder="Apellido" required>

<select id="estado" required>
<option value="">Selecciona tu estado</option>
<option>Aguascalientes</option><option>Baja California</option>
<option>Baja California Sur</option><option>Campeche</option>
<option>Chiapas</option><option>Chihuahua</option>
<option>Coahuila</option><option>Colima</option>
<option>CDMX</option><option>Durango</option>
<option>Estado de M√©xico</option><option>Guanajuato</option>
<option>Guerrero</option><option>Hidalgo</option>
<option>Jalisco</option><option>Michoac√°n</option>
<option>Morelos</option><option>Nayarit</option>
<option>Nuevo Le√≥n</option><option>Oaxaca</option>
<option>Puebla</option><option>Quer√©taro</option>
<option>Quintana Roo</option><option>San Luis Potos√≠</option>
<option>Sinaloa</option><option>Sonora</option>
<option>Tabasco</option><option>Tamaulipas</option>
<option>Tlaxcala</option><option>Veracruz</option>
<option>Yucat√°n</option><option>Zacatecas</option>
</select>

<input id="celular" placeholder="Celular 10 d√≠gitos" required>
<button type="submit">PARTICIPAR</button>
</form>

<div class="extra">
<h4>Consultar boletos</h4>
<input id="buscar" placeholder="Folio o celular">
<button onclick="consultar()">CONSULTAR</button>
</div>

<script>
const SCRIPT = "https://script.google.com/macros/s/AKfycbwn5pWXmgrtYhtsLUqDQhcuGsThOFIwZqmwAiQ14p9_YOMNBNHt6ABavQLHsVieYVUX/exec";

const grid = document.getElementById("grid");
const form = document.getElementById("form");
const contador = document.getElementById("contador");

let seleccionados = [];
const MAX_BOLETOS = 5;

/* CARGAR BOLETOS */
fetch(SCRIPT)
.then(r => r.json())
.then(ocupados => {
  for (let i = 1; i <= 200; i++) {
    const n = String(i).padStart(4,"0");
    const d = document.createElement("div");
    d.textContent = n;
    d.className = "num";

    if (ocupados.includes(n)) {
      d.classList.add("blocked");
    }

    d.onclick = () => {
      if (d.classList.contains("blocked")) return;

      if (!seleccionados.includes(n) && seleccionados.length >= MAX_BOLETOS) {
        alert("M√°ximo " + MAX_BOLETOS + " boletos");
        return;
      }

      d.classList.toggle("selected");

      if (seleccionados.includes(n)) {
        seleccionados = seleccionados.filter(x => x !== n);
      } else {
        seleccionados.push(n);
      }

      contador.textContent = "Boletos seleccionados: " + seleccionados.length;
    };

    grid.appendChild(d);
  }
});

/* PARTICIPAR */
form.addEventListener("submit", e => {
  e.preventDefault();

  if (seleccionados.length === 0) {
    alert("Selecciona al menos un boleto");
    return;
  }

  const tel = celular.value.replace(/\D/g,"");
  if (!/^\d{10}$/.test(tel)) {
    alert("Celular inv√°lido (10 d√≠gitos)");
    return;
  }

  const btn = form.querySelector("button");
  btn.disabled = true;
  btn.textContent = "Procesando...";

  const data = new FormData();
  data.append("nombre", nombre.value);
  data.append("apellido", apellido.value);
  data.append("estado", estado.value);
  data.append("celular", tel);
  data.append("boletos", seleccionados.join(","));

  fetch(SCRIPT, { method:"POST", body:data })
  .then(r => r.json())
  .then(res => {
    if (!res.folio) {
      alert("Error al registrar");
      btn.disabled = false;
      btn.textContent = "PARTICIPAR";
      return;
    }

    const msg = `üéü BOLETOS APARTADOS ‚Äì SORTEOS EL COLOTERO

FOLIO: ${res.folio}
Nombre: ${nombre.value} ${apellido.value}
Boletos: ${seleccionados.join(", ")}

üí∞ PREMIO: $1,500.00 MXN

Enviar comprobante de pago por este WhatsApp.
üçÄ MUCHA SUERTE üçÄ`;

    window.open(
      "https://wa.me/52" + tel + "?text=" + encodeURIComponent(msg),
      "_blank"
    );

    location.reload();
  });
});

function consultar(){
  if (!buscar.value) return;
  location.href = "boletos.html?buscar=" + buscar.value;
}
</script>

</body>
</html>
